name: Build

# Run this workflow every time a new commit pushed to your repository
on: [push]

jobs:

  build:
    name: ${{ matrix.config.name }}
    runs-on: ${{ matrix.config.os }}
    strategy:
      fail-fast: false
      matrix:
        config:
        - {
            name: "Windows Latest MSVC",
            os: windows-latest,
            build_type: "Release",
            cc: "cl",
            cxx: "cl"
          }   


    steps:
      # Checks out a copy of your repository on the ubuntu-latest machine
      - name: Checkout code
        uses: actions/checkout@v2
        
      - name: Install Qt
        uses: jurplel/install-qt-action@v2          

      - name: Prepare Visual Studio
        if: startsWith(matrix.config.os, 'windows')
        uses: ilammy/msvc-dev-cmd@v1
        with:
          sdk: 10.0.10240.0
          
      - name: Install Windows 8.1 SDK
        shell: powershell
        run: |
          Invoke-WebRequest -Method Get -Uri https://go.microsoft.com/fwlink/p/?LinkId=323507 -OutFile sdksetup.exe -UseBasicParsing
          Start-Process -Wait sdksetup.exe -ArgumentList "/q", "/norestart", "/features", "OptionId.WindowsDesktopSoftwareDevelopmentKit", "OptionId.NetFxSoftwareDevelopmentKit"          

      - name: Search Windows Kit
        if: startsWith(matrix.config.os, 'windows')
        run: |
          cd "C:\Program Files (x86)\Windows Kits\8.1\Lib\"
          dir
          cd winv6.3
          dir
          cd um
          dir 
          cd x64
          dir
          echo %%JAVA_HOME%%
          echo %JAVA_HOME%
          echo %%QTDIR%%
          echo %QTDIR%
          
          
      - name: Environment Checking
        shell: powershell
        run: |
          $env:QTDIR = 'QTDIR D:\a\Konclude\Qt\5.15.2\msvc2019_64'
          Get-ChildItem Env:JAVA_HOME
          Get-ChildItem Env:QTDIR


      - name: Compile Windows        
        if: startsWith(matrix.config.os, 'windows')
        run: |
          msbuild Konclude-VS15.sln /p:Configuration=Release /p:Platform="Win64"

      - name: Run Examples Windows
        if: startsWith(matrix.config.os, 'windows')  
        run: | 
          Release\Konclude.exe classification -i Tests/roberts-family-full-D.owl.xml -o roberts-family-full-class-hierarchy.owl.xml
          Release\Konclude.exe satisfiability -i Tests/roberts-family-full-D.owl.xml -x http://www.co-ode.org/roberts/family-tree.owl#Aunt
          Release\Konclude.exe owllinkfile -i Tests/galen-classify-request.xml -o response.xml
          Release\Konclude.exe owllinkfile -i Tests/roberts-family-full-D-classify-realize-request.xml
          Release\Konclude.exe owllinkfile -c Configs/default-config.xml -i Tests/1b-satisfiability-request.xml
          Release\Konclude.exe sparqlfile -s Tests/lubm-univ-bench-sparql-load-and-query-test.sparql -o Tests/query-answers.xml -c Configs/querying-config.xml
          Release\Konclude.exe sparqlfile -s Tests/roberts-family-full-sparql-existential-variables-query-test.sparql -i Tests/roberts-family-full-D.owl.xml
